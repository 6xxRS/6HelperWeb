<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/konva@9.3.18/konva.min.js"></script>
    <meta charset="utf-8" />
    <title>TheyNylocas - Battleships! Board Designer</title>
    <style>
        body {
            margin: 20px 20px 20px 20px;
            padding: 0;
            overflow: hidden;
            background-color: #000000;
            color: white;
        }
        body p {
            padding-left: 10px;
        }
        body #buttons {
            padding-left: 10px;
        }
        span {
            color: white;
            font-size: 25px;
        }
        #top {
            margin-top: 30px;
            margin-left: 30px;
        }
        #top span {
            margin-left: 24px;
            margin-right: 25px;
        }
        #side {
            margin-top: 22px;
            margin-bottom: 22px;
            writing-mode: vertical-rl;
            text-orientation: upright;
            word-spacing: 22px;
        }
        #container {
            color: white;
            margin-left: 30px;
            position: absolute;
            top: 135px;
        }
    </style>
  </head>
  <body>
    <p>Instructions: Drag the ships and mines to the desired locations. Click on them to rotate them 90 degrees. When finished, press the button to copy the image to your clipboard.</p>
    <div id="buttons"><button id="save">Copy to Clipboard</button></div>
    <div id="container"></div>
    <script>
        var width = window.innerWidth;
        var height = window.innerHeight;

        var stage = new Konva.Stage({
            container: 'container',
            width: width,
            height: height,
        });
        

        function drawGameBoard() {
            var layer = new Konva.Layer();

            var game_bg = new Konva.Image({
                image: background,
                x: 0,
                y: 0,
                width: 660,
                height: 660,
                draggable: false,
            });

            
            var ship5a = new Konva.Image({
                image: ship_5a,
                x: 700,
                y: 20,
                width: 310,
                height: 62,
                draggable: true,
            });

            var ship5b = new Konva.Image({
                image: ship_5b,
                x: 700,
                y: 90,
                width: 319,
                height: 64,
                draggable: true,
            });

            var ship4a = new Konva.Image({
                image: ship_4a,
                x: 700,
                y: 160,
                width: 248,
                height: 62,
                draggable: true,
            });

            var ship4b = new Konva.Image({
                image: ship_4b,
                x: 700,
                y: 230,
                width: 257,
                height: 65,
                draggable: true,
            });

            var ship3a = new Konva.Image({
                image: ship_3a,
                x: 700,
                y: 300,
                width: 190,
                height: 64,
                draggable: true,
            });

            var ship3b = new Konva.Image({
                image: ship_3b,
                x: 700,
                y: 370,
                width: 190,
                height: 62,
                draggable: true,
            });

            var ship2a = new Konva.Image({
                image: ship_2a,
                x: 700,
                y: 440,
                width: 126,
                height: 64,
                draggable: true,
            });

            var ship2b = new Konva.Image({
                image: ship_2b,
                x: 700,
                y: 510,
                width: 128,
                height: 62,
                draggable: true,
            });

            var mine1 = new Konva.Image({
                image: mine,
                x: 700,
                y: 580,
                width: 66,
                height: 66,
                draggable: true,
            });

            var mine2 = new Konva.Image({
                image: mine,
                x: 770,
                y: 580,
                width: 66,
                height: 66,
                draggable: true,
            });

            var mine3 = new Konva.Image({
                image: mine,
                x: 840,
                y: 580,
                width: 66,
                height: 66,
                draggable: true,
            });

            var mine4 = new Konva.Image({
                image: mine,
                x: 910,
                y: 580,
                width: 66,
                height: 66,
                draggable: true,
            });

            var mine5 = new Konva.Image({
                image: mine,
                x: 980,
                y: 580,
                width: 66,
                height: 66,
                draggable: true,
            });

            
            ship5a.on('mouseover', function () {
                document.body.style.cursor = 'pointer';
            });
            ship5a.on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            ship5a.on('click', function() {
                ship5a.rotate(90);
            });

            ship5b.on('mouseover', function () {
                document.body.style.cursor = 'pointer';
            });
            ship5b.on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            ship5b.on('click', function() {
                ship5b.rotate(90);
            });

            ship4a.on('mouseover', function () {
                document.body.style.cursor = 'pointer';
            });
            ship4a.on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            ship4a.on('click', function() {
                ship4a.rotate(90);
            });

            ship4b.on('mouseover', function () {
                document.body.style.cursor = 'pointer';
            });
            ship4b.on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            ship4b.on('click', function() {
                ship4b.rotate(90);
            });

            ship3a.on('mouseover', function () {
                document.body.style.cursor = 'pointer';
            });
            ship3a.on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            ship3a.on('click', function() {
                ship3a.rotate(90);
            });

            ship3b.on('mouseover', function () {
                document.body.style.cursor = 'pointer';
            });
            ship3b.on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            ship3b.on('click', function() {
                ship3b.rotate(90);
            });

            ship2a.on('mouseover', function () {
                document.body.style.cursor = 'pointer';
            });
            ship2a.on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            ship2a.on('click', function() {
                ship2a.rotate(90);
            });

            ship2b.on('mouseover', function () {
                document.body.style.cursor = 'pointer';
            });
            ship2b.on('mouseout', function () {
                document.body.style.cursor = 'default';
            });
            ship2b.on('click', function() {
                ship2b.rotate(90);
            });


            ship5a.on('dragend', (e) => {
                ship5a.position({
                    x: (Math.round(ship5a.x() / 66) * 66),
                    y: (Math.round(ship5a.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            ship5a.on('dragmove', (e) => {
                ship5a.position({
                    x: (Math.round(ship5a.x() / 66) * 66),
                    y: (Math.round(ship5a.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            ship5b.on('dragend', (e) => {
                ship5b.position({
                    x: (Math.round(ship5b.x() / 66) * 66),
                    y: (Math.round(ship5b.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            ship5b.on('dragmove', (e) => {
                ship5b.position({
                    x: (Math.round(ship5b.x() / 66) * 66),
                    y: (Math.round(ship5b.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            ship4a.on('dragend', (e) => {
                ship4a.position({
                    x: (Math.round(ship4a.x() / 66) * 66),
                    y: (Math.round(ship4a.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            ship4a.on('dragmove', (e) => {
                ship4a.position({
                    x: (Math.round(ship4a.x() / 66) * 66),
                    y: (Math.round(ship4a.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            ship4b.on('dragend', (e) => {
                ship4b.position({
                    x: (Math.round(ship4b.x() / 66) * 66),
                    y: (Math.round(ship4b.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            ship4b.on('dragmove', (e) => {
                ship4b.position({
                    x: (Math.round(ship4b.x() / 66) * 66),
                    y: (Math.round(ship4b.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            ship3a.on('dragend', (e) => {
                ship3a.position({
                    x: (Math.round(ship3a.x() / 66) * 66),
                    y: (Math.round(ship3a.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            ship3a.on('dragmove', (e) => {
                ship3a.position({
                    x: (Math.round(ship3a.x() / 66) * 66),
                    y: (Math.round(ship3a.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            ship3b.on('dragend', (e) => {
                ship3b.position({
                    x: (Math.round(ship3b.x() / 66) * 66),
                    y: (Math.round(ship3b.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            ship3b.on('dragmove', (e) => {
                ship3b.position({
                    x: (Math.round(ship3b.x() / 66) * 66),
                    y: (Math.round(ship3b.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            ship2a.on('dragend', (e) => {
                ship2a.position({
                    x: (Math.round(ship2a.x() / 66) * 66),
                    y: (Math.round(ship2a.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            ship2a.on('dragmove', (e) => {
                ship2a.position({
                    x: (Math.round(ship2a.x() / 66) * 66),
                    y: (Math.round(ship2a.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            ship2b.on('dragend', (e) => {
                ship2b.position({
                    x: (Math.round(ship2b.x() / 66) * 66),
                    y: (Math.round(ship2b.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            ship2b.on('dragmove', (e) => {
                ship2b.position({
                    x: (Math.round(ship2b.x() / 66) * 66),
                    y: (Math.round(ship2b.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            mine1.on('dragend', (e) => {
                mine1.position({
                    x: (Math.round(mine1.x() / 66) * 66),
                    y: (Math.round(mine1.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            mine1.on('dragmove', (e) => {
                mine1.position({
                    x: (Math.round(mine1.x() / 66) * 66),
                    y: (Math.round(mine1.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            mine2.on('dragend', (e) => {
                mine2.position({
                    x: (Math.round(mine2.x() / 66) * 66),
                    y: (Math.round(mine2.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            mine2.on('dragmove', (e) => {
                mine2.position({
                    x: (Math.round(mine2.x() / 66) * 66),
                    y: (Math.round(mine2.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            mine3.on('dragend', (e) => {
                mine3.position({
                    x: (Math.round(mine3.x() / 66) * 66),
                    y: (Math.round(mine3.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            mine3.on('dragmove', (e) => {
                mine3.position({
                    x: (Math.round(mine3.x() / 66) * 66),
                    y: (Math.round(mine3.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            mine4.on('dragend', (e) => {
                mine4.position({
                    x: (Math.round(mine4.x() / 66) * 66),
                    y: (Math.round(mine4.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            mine4.on('dragmove', (e) => {
                mine4.position({
                    x: (Math.round(mine4.x() / 66) * 66),
                    y: (Math.round(mine4.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            mine5.on('dragend', (e) => {
                mine5.position({
                    x: (Math.round(mine5.x() / 66) * 66),
                    y: (Math.round(mine5.y() / 66) * 66)
                });
                stage.batchDraw();
            });
            mine5.on('dragmove', (e) => {
                mine5.position({
                    x: (Math.round(mine5.x() / 66) * 66),
                    y: (Math.round(mine5.y() / 66) * 66)
                });
                stage.batchDraw();
            });

            layer.add(game_bg);

            layer.add(ship5a);
            layer.add(ship5b);
            layer.add(ship4a);
            layer.add(ship4b);
            layer.add(ship3a);
            layer.add(ship3b);
            layer.add(ship2a);
            layer.add(ship2b);
            layer.add(mine1);
            layer.add(mine2);
            layer.add(mine3);
            layer.add(mine4);
            layer.add(mine5);

            stage.add(layer);

        }

        var background = new Image();
        background.onload = function() {
            drawGameBoard();
        };
        background.src = 'https://i.imgur.com/Jky58kZ.png';

        
        var ship_5a = new Image();
        ship_5a.onload = function () {};
        ship_5a.src = 'https://i.imgur.com/LTnnUU3.png';

        var ship_5b = new Image();
        ship_5b.onload = function () {};
        ship_5b.src = 'https://i.imgur.com/ZjuPx41.png';

        var ship_4a = new Image();
        ship_4a.onload = function () {};
        ship_4a.src = 'https://i.imgur.com/lJLYpuz.png';

        var ship_4b = new Image();
        ship_4b.onload = function () {};
        ship_4b.src = 'https://i.imgur.com/829KTlg.png';

        var ship_3a = new Image();
        ship_3a.onload = function () {};
        ship_3a.src = 'https://i.imgur.com/hcBgSRL.png';

        var ship_3b = new Image();
        ship_3b.onload = function () {};
        ship_3b.src = 'https://i.imgur.com/91Ja90p.png';

        var ship_2a = new Image();
        ship_2a.onload = function () {};
        ship_2a.src = 'https://i.imgur.com/FIvWICQ.png';

        var ship_2b = new Image();
        ship_2b.onload = function () {};
        ship_2b.src = 'https://i.imgur.com/6zMh6C2.png';

        var mine = new Image();
        mine.onload = function () {};
        mine.src = 'https://i.imgur.com/flLFMiU.png';

        background.crossOrigin = 'Anonymous';
        ship_5a.crossOrigin = 'Anonymous';
        ship_5b.crossOrigin = 'Anonymous';
        ship_4a.crossOrigin = 'Anonymous';
        ship_4b.crossOrigin = 'Anonymous';
        ship_3a.crossOrigin = 'Anonymous';
        ship_3b.crossOrigin = 'Anonymous';
        ship_2a.crossOrigin = 'Anonymous';
        ship_2b.crossOrigin = 'Anonymous';
        mine.crossOrigin = 'Anonymous';

        async function exportStageToClipboard(stage) {
            const dataURL = stage.toDataURL();

            try {
                const blob = await (await fetch(dataURL)).blob();
                const item = new ClipboardItem({ "image/png": blob });
                await navigator.clipboard.write([item]);
                alert("Game board copied to clipboard successfully!\nYou may simply paste this (ctrl + v) into your team channel in Discord.");
            } catch (error) {
                alert("Failed to copy game board to clipboard. Please try again or contact @6xx on Discord.");
            }
        }

        document.getElementById('save').addEventListener(
            'click',
            function () {
                exportStageToClipboard(stage);
            },
            false
        );
    </script>
  </body>
</html>